{"componentChunkName":"component---packages-gatsby-theme-kenny-blog-core-src-templates-post-query-tsx","path":"/getting-the-actual-client-ip-address-in-nginx-reverse-proxy","result":{"data":{"post":{"__typename":"MdxPost","id":"a719910b-5077-5a02-a17a-349d66eb3cf5","slug":"/getting-the-actual-client-ip-address-in-nginx-reverse-proxy","title":"Getting the Actual Client IP Address in Nginx Reverse Proxy","date":"18.01.2024","tags":[{"name":"DevOps","slug":"dev-ops"}],"description":"Learn how to retrieve the real client's IP address in Nginx reverse proxy setups. Explore configurations using \"X-Real-IP\" headers and find out the best practices for server-side handling. Additionally, discover the essential difference between Nginx reload and restart commands, ensuring smooth configuration updates without compromising server uptime. Optimize your Nginx setup for improved performance and reliability.","body":"var _excluded = [\"components\"];\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n/* @jsxRuntime classic */\n/* @jsx mdx */\n\nvar _frontmatter = {\n  \"title\": \"Getting the Actual Client IP Address in Nginx Reverse Proxy\",\n  \"date\": \"2024-01-18T00:00:00.000Z\",\n  \"description\": \"Learn how to retrieve the real client's IP address in Nginx reverse proxy setups. Explore configurations using \\\"X-Real-IP\\\" headers and find out the best practices for server-side handling. Additionally, discover the essential difference between Nginx reload and restart commands, ensuring smooth configuration updates without compromising server uptime. Optimize your Nginx setup for improved performance and reliability.\",\n  \"banner\": \"../_images/real-client-ip-nginx.webp\",\n  \"tags\": [\"DevOps\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n    props = _objectWithoutProperties(_ref, _excluded);\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"span\", {\n    parentName: \"p\",\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"100%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/webp;base64,UklGRvgAAABXRUJQVlA4IOwAAADwBQCdASoUABQAPtFgqU+oJaOiKAgBABoJZgCdMoM766SoJPWDkQ9ySp/lzLf51rKavkcehR//gAD+rcZ5X6Wn0bx7GLlT2TmSTBjCId/IRq+jUjktcJQ86O4VBgljqZZXeyG5O54XGpDvx0/Umqe+scitm9T8uF2iM08lACUWuzBN21Q0GidLfaqHa6ySD5eg6Niw7D6Z95cO0ck7YG13ZTtmxX1s4b9CIWTvLejf5pDnmv1s7itoSnApzxgvWZizoiCEht70+MNiZR+EdS5UAssB18KE0JwFeYGWFBT4E2UNn1LSIt1ySws4AA==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"real ip in nginx\",\n    \"title\": \"real ip in nginx\",\n    \"src\": \"/static/3ff0dd0b7d7a30339a7bf4f7d7777b94/10c02/real-client-ip-nginx.webp\",\n    \"srcSet\": [\"/static/3ff0dd0b7d7a30339a7bf4f7d7777b94/cbea2/real-client-ip-nginx.webp 240w\", \"/static/3ff0dd0b7d7a30339a7bf4f7d7777b94/42669/real-client-ip-nginx.webp 480w\", \"/static/3ff0dd0b7d7a30339a7bf4f7d7777b94/10c02/real-client-ip-nginx.webp 960w\", \"/static/3ff0dd0b7d7a30339a7bf4f7d7777b94/44907/real-client-ip-nginx.webp 1024w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  }), \"\\n    \")), mdx(\"p\", null, \"When using Nginx as a reverse proxy server, obtaining the actual client's IP address can be a bit complex. By default, Nginx records the remote address of requests forwarded through a proxy pass. However, to acquire the real client's IP address, several configurations are necessary.\"), mdx(\"p\", null, \"One approach is to use the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"X-Real-IP\"), \" header to transmit the client's actual IP address. Below is an example implementation in the Nginx configuration file:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\"\n  }, \"Copy code\\nserver {\\nlisten 80;\\nserver_name example.com;\\n\\n    location / {\\n        proxy_pass http://your_upstream_server;\\n        proxy_set_header Host $host;\\n        proxy_set_header X-Real-IP $remote_addr;\\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\\n        proxy_set_header X-Forwarded-Proto $scheme;\\n    }\\n\\n    # ... Other configurations ...\\n}\\n\")), mdx(\"p\", null, \"In this setup, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"proxy_set_header X-Real-IP $remote_addr;\"), \" instructs Nginx to add the client's actual IP address to the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"X-Real-IP\"), \" header.\"), mdx(\"p\", null, \"Subsequently, on the server side, you can extract the actual client IP using this header. For instance, in a Node.js server:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-javascript\"\n  }, \"const express = require('express');\\nconst app = express();\\n\\napp.use((req, res, next) => {\\n  const clientIP = req.headers['x-real-ip'] || req.connection.remoteAddress;\\n  console.log(`Client IP: ${clientIP}`);\\n  next();\\n});\\n\\n// Additional routing and middleware configurations...\\n\\nconst port = 3000;\\napp.listen(port, () => {\\n  console.log(`Server is running on port ${port}`);\\n});\\n\")), mdx(\"p\", null, \"This way, you can retrieve the actual client IP address from requests forwarded through Nginx's reverse proxy server.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Bonus Tip: Nginx Reload vs Restart\")), mdx(\"p\", null, \"When restarting Nginx, it's crucial to understand the difference between \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"reload\"), \" and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"restart\"), \". The reload command re-reads the configuration file without stopping the web server, maintaining its current state even if there are issues. Conversely, restart involves stopping and then restarting Nginx, which may lead to downtime if problems arise during the restart process.\"), mdx(\"p\", null, \"Remember to validate the configuration syntax with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"nginx -t\"), \" before reloading to ensure a smooth transition.\"), mdx(\"p\", null, \"Now, let's continue exploring and optimizing your Nginx setup for a seamless web-serving experience!\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"When using Nginx as a reverse proxy server, obtaining the actual client's IP address can be a bit complex. By default, Nginx records theâ€¦","timeToRead":1,"banner":{"childImageSharp":{"resize":{"src":"/static/3ff0dd0b7d7a30339a7bf4f7d7777b94/a7c53/real-client-ip-nginx.webp"}}}}},"pageContext":{"slug":"/getting-the-actual-client-ip-address-in-nginx-reverse-proxy"}},"staticQueryHashes":["1386366609","1386366609","1580740877"]}